{% extends 'base/main.html' %}
{% load static %}
{% block content %}

<title>{% block title%}Permessi in corso{% endblock %}</title>
<link rel="stylesheet" href="{% static 'gestione/css/style.css' %}">
<script src="{% static 'gestione/js/script.js' %}"></script>

<section style="box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2); margin-left:268px;">
  <header class="p-3 bg-light text-black">
      <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
  
      <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
          <li class="nav-link px-2 text-dark"></li>            
          <li class="nav-link px-2 text-dark"><strong>{{in_permesso}}</strong> In permesso</li> 
          <li class="nav-link px-2 text-dark"><strong>{{rientranti}}</strong> Rientranti</li> 
          <li class="nav-link px-2 text-dark"><strong>{{errore}}</strong></li> 
      </ul>
      <form method="post" action="{% url 'gestione:richieste-accettate' %}" id="reception-form-cerca" class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3">
        {% csrf_token %}
        <input type="search" name="dipendente" class="form-control form-control-dark" id="dipendente" placeholder="Dipendente" aria-label="Dipendente" value="{{cerca}}">
      </form>
      <button type="submit" name="dipendente" id="button-cerca-dipendente" class="btn btn-primary" onclick="submitForm()">Cerca</button>
      <div class="text-end" style="margin-right:15px; margin-left:15px;">Filtra per dipendente</div>
      <div class="text-end" style="margin-right:15px;">
        <button type="button" name="precedente" id="reception-button-precedente" class="btn btn-warning" onclick="submitFormPrecedente()">Precedente</button>
      </div>
      <form method="post" action="{% url 'gestione:richieste-accettate' %}" id="reception-form-giorno" class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3">
        {% csrf_token %}
        <input type="date" name="giorno" id="giorno" class="form-control form-control-dark" placeholder="Giorno..." aria-label="Giorno" value="{{data|date:'Y-m-d'}}">
      </form>
      <div class="text-end">
        <button type="button" name="cerca-giorno" id="reception-button-giorno" class="btn btn-outline-dark me-2" onclick="submitFormGiorno()">Cerca</button>
        <button type="button" name="successivo" id="reception-button-successivo" class="btn btn-warning" onclick="submitFormSuccessivo()">Successivo</button>
        <button type="button" name="scarica" id="reception-button-scarica" class="btn btn-success" onclick="scaricaForm()">Scarica</button>

      </div>
</header>
</section>

<section style="margin-left:300px; margin-top:25px;">
  <div class="cartaBox-table-reception-datatables">

          <div class="carta-table-reception-datatables">
              <div>
                  <div class="numbers">{{richieste|length}}</div>
                  <div class="no-hover">
                  <table class="table table-striped table-hover caption-top">
                    <caption>Lista Richieste Accettate, {{data}}</caption>
                      <thead>
                      <tr>
                        <th scope="col"></th>
                        <th scope="col">Dipendente</th>
                        <th scope="col">Area</th>
                        <th scope="col">Responsabile</th>
                        <th scope="col">Permesso</th>
                        <th scope="col">Inizio</th>
                        <th scope="col">Ritorno</th>
                        <th scope="col">Orario</th>
                        <th scope="col">Urgente</th>
                      </tr>
                      </thead>
                      <tbody>
                      {% for richiesta in richieste %}
                          <tr>
                              <th scope="col">
                                  <div class="dropdown">
                                      <a href="#" class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle" id="dropdownUser2" data-bs-toggle="dropdown" aria-expanded="false">
                                          <i class="bi bi-plus-square-fill"></i>
                                      </a>
                                          <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser2">
                                    <li><a class="dropdown-item"  onclick="open_modal_conferma_richieste_accettate('{% url 'gestione:conferma-richieste-accettate' richiesta.pk %}')">Conferma Richiesta</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" onclick="open_modal_modifica_richieste_accettate('{% url 'gestione:modifica-richieste-accettate' richiesta.pk %}')">Modifica</a></li>
                                      </ul>
                                  </div>
                              </th>
                            <td>{{richiesta.id_richieste.nominativo}}</td>
                            <td>{{richiesta.id_richieste.id_dipendente_richiesta.area}}</td>
                            <td>{{richiesta.id_capoarea_richieste.nomecompleto}}</td>
                            <td> <div {% if richiesta.id_richieste.id_permessi_richieste.id_permesso == 2 %} class="stato maternita text-center" style="color:white;" {% elif richiesta.id_richieste.id_permessi_richieste.id_permesso == 13 %} class="stato malattia text-center" style="color:white;"{% elif richiesta.id_richieste.id_permessi_richieste.id_permesso == 6 %} class="stato ferie text-center" style="color:white;" {% elif richiesta.id_richieste.id_permessi_richieste.id_permesso != 6 %} class="stato permesso text-center" style="color:white;" {% endif %}> {% if richiesta.id_richieste.id_permessi_richieste %} {{richiesta.id_richieste.id_permessi_richieste.codicepermesso|title}} {% else %} Permesso Orario {% endif %}</div></td>
                            <td>{{richiesta.data_inizio_permesso|date:"j N Y"}}</td>
                            <td>{% if richiesta.data_fine_permesso %}{{richiesta.data_fine_permesso|date:"j N Y"}} {% else %} -- {% endif %}</td>
                            <td>{% if richiesta.ora_inizio_permesso %}da {{richiesta.ora_inizio_permesso|time:"H:i"}} a {{richiesta.ora_fine_permesso|time:"H:i"}} {% else %} -- {% endif %}</td>
                            <td>{% if richiesta.id_richieste.urgente %} Si {% else %} No {% endif %}</td>
                            {% endfor %}
                      </tbody>
                  </table>
              </div>
              </div>
              <div class="iconBox">
                <svg xmlns="http://www.w3.org/2000/svg" width="55" height="55" fill="currentColor" class="bi bi-pc-display-horizontal" viewBox="0 0 16 16">
                  <path d="M1.5 0A1.5 1.5 0 0 0 0 1.5v7A1.5 1.5 0 0 0 1.5 10H6v1H1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5v-1h4.5A1.5 1.5 0 0 0 16 8.5v-7A1.5 1.5 0 0 0 14.5 0h-13Zm0 1h13a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .5-.5ZM12 12.5a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0Zm2 0a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0ZM1.5 12h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1ZM1 14.25a.25.25 0 0 1 .25-.25h5.5a.25.25 0 1 1 0 .5h-5.5a.25.25 0 0 1-.25-.25Z"/>
              </svg>
              </div>
              </a>
          </div>
  </div>    


</section>

<div class="modal fade" id="confermaRichiesteAccettateModal" role="dialog" tabindex="-1">
</div>

<div class="modal fade" id="modificaRichiesteAccettateModal" role="dialog" tabindex="-1">
</div>

<script>

var $ = jQuery.noConflict();
function open_modal_conferma_richieste_accettate(url){
    $('#confermaRichiesteAccettateModal').load(url,function(){
    $(this).modal('show'); 
    });
};

var $ = jQuery.noConflict();
function open_modal_modifica_richieste_accettate(url){
    $('#modificaRichiesteAccettateModal').load(url,function(){
      $('#firstModal').modal('hide');
      $(this).modal('show'); 
    });
};
</script>

{% endblock %}

