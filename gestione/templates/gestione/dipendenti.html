{% extends 'base/main.html' %}

{% load static %}

{% block content %}

<title>{% block title%}Presenze{% endblock %}</title>
<script src="{% static 'reception/js/script.js' %}"></script>
<link rel="stylesheet" href="{% static 'base/css/datatables.css' %}">
<!-- Datatables -->

<link href="https://cdn.datatables.net/1.13.2/css/jquery.dataTables.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdn.datatables.net/1.13.2/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/v/bs5/jszip-2.5.0/dt-1.13.2/af-2.5.2/b-2.3.4/b-colvis-2.3.4/b-html5-2.3.4/b-print-2.3.4/cr-1.6.1/date-1.3.0/fc-4.2.1/fh-3.3.1/kt-2.8.1/r-2.4.0/rg-1.3.0/rr-1.3.2/sc-2.1.0/sb-1.4.0/sp-2.1.1/sr-1.2.1/datatables.min.js"></script>
    

<section id="styler-navbar" style="box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2); margin-left:210px;">
  <header class="p-3 bg-light text-black">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
          <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
            <li class="nav-link px-2 text-dark"></li>
            <li class="nav-link px-2 text-dark"><strong>{{dipendentiAttivi}}</strong> Dipendenti Attivi</li>
            <li class="nav-link px-2 text-dark"><strong>{{dipendentiCessati}}</strong> Dipendenti Cessati</li>
            <li class="nav-link px-2 text-dark"><strong>{{dipendentiSospesi}}</strong> Dipendenti Sospesi</li>
        </ul>
        <form method="POST" action="{% url 'gestione:dipendenti' %}">
          {% csrf_token %}
        <button type="submit" id="attivi" name="attivi" value="attivi" class="btn btn-success">Attivi</button>
        </form>
        <form method="POST" action="{% url 'gestione:dipendenti' %}">
          {% csrf_token %}
          <button type="submit" id="cessati" name="cessati" value="cessati" class="btn btn-danger">Cessati</button>
        </form>
        <form method="POST" action="{% url 'gestione:dipendenti' %}">
          {% csrf_token %}
          <button type="submit" id="sospesi" name="sospesi" value="sospesi" class="btn btn-warning" style="margin-right:15px;">Sospesi</button>
        </form>
      <form method="POST" action="{% url 'gestione:dipendenti' %}" class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3">
        {% csrf_token %}
          <input type="input" name="getDip" id="getDip" class="form-control form-control-dark" placeholder="Search..." aria-label="Search">
      </form>
  </header>
</section>
  
<section style="margin-left:300px; margin-top:25px;">
  <div class="cartaBox-table-reception-datatables">
          <div class="carta-table-reception-datatables">
                <div>
                  <div class="numbers">{{dipendenti|length}}</div>
                  <div class="no-hover">
                      <table class="table table-striped table-hover caption-top" id="table-presenze">
                        <caption>Dipendenti</caption>
                        <thead>
                        <tr>
                          <th>Dipendente </th>
                          <th>Area</th>
                          <th>Societ&#224;</th>
                          <th>Sede</th>
                          <th>Tipo Contratto</th>
                          <th>Scadenza Contratto</th>
                        </tr>
                        </thead>
                        <tbody>
                          {% for dipendente in dipendenti %}
                          <tr>
                              <td>
                                <div class="d-flex align-items-center">
                                  <span>{{dipendente.nominativo}}</span>
                                  <span>  
                                    <div class="dropdown">
                                      <a href="#" class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle" id="dropdownUser2" data-bs-toggle="dropdown" aria-expanded="false">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-mouse-fill" viewBox="0 0 16 16">
                                          <path d="M3 5a5 5 0 0 1 10 0v6a5 5 0 0 1-10 0V5zm5.5-1.5a.5.5 0 0 0-1 0v2a.5.5 0 0 0 1 0v-2z"/>
                                      </svg>
                                      </a>
                                      <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser2">
                                        <li><a class="dropdown-item" onclick="openModalStato('{% url 'gestione:update-stato' dipendente.pk %}')">Cambia Stato</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item" href="{% url 'gestione:update-anagrafica' dipendente.pk %}">Modifica Anagrafica</a></li>
                                      </ul>
                                      </div>
                                  </div>
                                </span>
                              </td>
                              <td>{% if dipendente.area %} {{dipendente.area|title}} {% endif %}</td>
                              <td>{% if dipendente.societa %} {{dipendente.societa|title}} {% endif %}</td>
                              <td>{% if dipendente.sede %} {{dipendente.sede|title}} {% endif %}</td>
                              <td>{% if dipendente.tipo_contratto %} {{dipendente.tipo_contratto|title}} {% endif %}</td>
                              <td>{% if dipendente.data_fine_rap %} {{dipendente.data_fine_rap|date:'d-m-Y'}} {% endif %}</td>
                            </tr>
                              {% endfor %}
                        </tbody>
                        <tfoot>
                          <tr>
                            <th>Dipendente </th>
                            <th>Area</th>
                            <th>Societ&#224;</th>
                            <th>Sede</th>
                            <th>Tipo Contratto</th>
                            <th>Scadenza Contratto</th>
                          </tr>
                      </tfoot>
                    </table>
                </div>
                </div>
                <div class="iconBox">
                  <a href="{% url 'gestione:anagrafica-dipendente' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="55" height="55" fill="currentColor" class="bi bi-person-fill-add" viewBox="0 0 16 16">
                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0Zm-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                        <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                    </svg>
                  </a>
                </div>
            </div>
    </div>    
</section>

<div class="modal fade" id="modificaIngresso" role="dialog" tabindex="-1">
</div>

<script>
    var $ = jQuery.noConflict();
function open_modal_modifica_ingresso(url){
    $('#modificaIngresso').load(url,function(){
    $(this).modal('show'); 
    });
};


  $(document).ready(function () {
      // Setup - add a text input to each footer cell
      $('#table-presenze thead tr')
          .clone(true)
          .addClass('filters')
          .appendTo('#table-presenze thead');
      
      var table = $('#table-presenze').DataTable({
          orderCellsTop: true,
          fixedHeader: true,
          dom: 'Bfrtip',
          buttons: [
            {
                extend: 'copy',
                className: 'btn btn-secondary',
                text: 'Copia'
            },
            {
                extend: 'excel',
                className: 'btn btn-success',
                text: 'Excel'
            },
            {
                extend: 'pdfHtml5',
                className: 'btn btn-danger',
                text: 'PDF',
                orientation: 'landscape',
                pageSize: 'A3',
                exportOptions: {
                columns: ':visible'
                },
                customize: function(doc) {
                    doc.content.forEach(function(item) {
                    if (item.text) {
                    item.text[0].fontSize = 8 // Set the font size to 8pt
                    }
                });
                }
            },
        ],
          initComplete: function () {
              var api = this.api();
      
              // For each column
              api
                  .columns()
                  .eq(0)
                  .each(function (colIdx) {
                      // Set the header cell to contain the input element
                      var cell = $('.filters th').eq(
                          $(api.column(colIdx).header()).index()
                      );
                      var title = $(cell).text();
                      $(cell).html('<input type="text" placeholder="' + title + '" />');
      
                      // On every keypress in this input
                      $(
                          'input',
                          $('.filters th').eq($(api.column(colIdx).header()).index())
                      )
                          .off('keyup change')
                          .on('change', function (e) {
                              // Get the search value
                              $(this).attr('title', $(this).val());
                              var regexr = '({search})'; //$(this).parents('th').find('select').val();
      
                              var cursorPosition = this.selectionStart;
                              // Search the column for that value
                              api
                                  .column(colIdx)
                                  .search(
                                      this.value != ''
                                          ? regexr.replace('{search}', '(((' + this.value + ')))')
                                          : '',
                                      this.value != '',
                                      this.value == ''
                                  )
                                  .draw();
                          })
                          .on('keyup', function (e) {
                              e.stopPropagation();
      
                              $(this).trigger('change');
                              $(this)
                                  .focus()[0]
                                  .setSelectionRange(cursorPosition, cursorPosition);
                          });
                  });
          },
      });
  });
  
  </script>
{% endblock content %}
